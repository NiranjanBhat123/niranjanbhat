{% load static %}
{% include 'base.html' %}
{% block content %}

<style>
    body {
        font-family: 'Montserrat';
        background-color: #1a1a1a;
        color: #fff;
        padding: 20px;
    }



    .profile-card {

        display: flex;
        align-items: center;
        background-color: #222;
        /* Dark background color for dark mode */
        color: #fff;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        transition: background-color 0.3s;
        overflow: hidden;
    }

    .profile-card img {
        max-width: 100px;
        border-radius: 50%;
        margin-right: 20px;
    }

    .profile-details {
        flex: 1;
    }

    .profile-details h2,
    .profile-details h4,
    .profile-details p {
        margin: 0;
        font-size: 1.5em;
    }

    .profile-details h2 {
        color: #3498db;
    }

    .profile-details h4 {
        color: #e74c3c;
    }

    .book-container {
        margin-top: 2rem;
        display: flex;
        justify-content:space-evenly;
        flex-wrap: wrap;
    }

    .book-card {
        cursor: pointer;
        height: 10rem;
        position: relative;
        background-color: #343434;
        color: #fff;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        transition: background-color 0.3s;
        overflow: hidden;
    }

    .book-card:not(.not-available):hover {
        transform: translateY(-15px);
        transition: transform 0.3s;
    }

    .book-card h3 {
        margin-bottom: 10px;
        font-size: 1.2em;
    }

    .book-card p {
        font-size: 0.9em;
        margin: 0;
    }

    .book-card .isbn {
        margin-bottom: .5rem;
        position: absolute;
        bottom: 5px;
        left: 5px;
        background-color: #e74c3c;
        color: #fff;
        padding: 5px;
        border-radius: 4px;
    }

    .book-card .genre {
        margin-bottom: .5rem;
        position: absolute;
        bottom: 5px;
        right: 5px;
        background-color: #27ae60;
        color: #fff;
        padding: 5px;
        border-radius: 4px;
    }

    .pdf-popover {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(44, 62, 80, 1);
        /* Increased opacity for background */
        border: 1px solid #3498db;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        max-width: 80%;
        max-height: 80%;
        overflow: auto;
        z-index: 1000;
        padding: 20px;
        border-radius: 8px;
        color: #fff;
    }

    .pdf-popover iframe {
        width: 100%;
        height: 60vh;
        border: none;
        margin-bottom: 10px;
    }

    .btn-container {
        text-align: center;
    }

    .pdf-btn,
    .copy-btn,
    .close-btn {
        background-color: #27ae60;
        color: #fff;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 1em;
        margin-right: 10px;
        cursor: pointer;
    }

    .copy-btn {
        background-color: #e74c3c;
    }

    .close-btn {
        background-color: #3498db;
    }

    .book-info {
        margin-bottom: 10px;
    }

    .isbn-info {
        font-weight: bold;
    }
</style>

<h3>My Profile</h3>
<div class="profile-card">
    <img src="{% static 'profile_image.webp' %}" alt="Profile Image">
    <div class="profile-details">
        <h2>{{user_profile.first_name}} {{user_profile.last_name}}</h2>
        <h4>Student ID: {{user_profile.student_id}}</h4>
        <h4>Email: {{user_profile.email}}</h4>
    </div>
</div>

<h3 style="margin-top: 4rem;">My books</h3>

<div class="book-container">

    {% if user_profile.book1 %}
    <div class="book-card">
        <h2>{{ user_profile.book1.title }}</h2>
        <p>Author: {{ user_profile.book1.author }}</p>
        <p class="isbn">ISBN: {{ user_profile.book1.isbn_number }}</p>
        <p class="genre">Genre: {{ user_profile.book1.genre.name }}</p>
    </div>
    {% endif %}

    {% if user_profile.book2 %}
    <div class="book-card">
        <h2>{{ user_profile.book2.title }}</h2>
        <p>Author: {{ user_profile.book2.author }}</p>
        <p class="isbn">ISBN: {{ user_profile.book2.isbn_number }}</p>
        <p class="genre">Genre: {{ user_profile.book2.genre.name }}</p>
    </div>
    {% endif %}

</div>


<div class="pdf-popover" id="pdf-viewer">
    <div class="book-info" id="book-info"></div>
    <iframe src="" frameborder="0"></iframe>
    <div class="btn-container">
        <button class="copy-btn" onclick="copyISBN()">copy ISBN</button>
        <button class="close-btn" onclick="closePopover()"><svg xmlns="http://www.w3.org/2000/svg" width="16"
                height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                <path
                    d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
            </svg></button>
    </div>
</div>



<script>
    function loadPDF(pdfUrl) {
        const pdfViewer = document.getElementById('pdf-viewer');
        const iframe = pdfViewer.querySelector('iframe');
        iframe.src = pdfUrl;
        pdfViewer.style.display = 'block';

        // Display basic book information
        const bookInfoElement = document.getElementById('book-info');
        const activeBook = document.querySelector('.recent-book.active');
        const bookTitle = activeBook.querySelector('h3').textContent.trim();
        const authorName = activeBook.querySelector('.author').textContent.trim();
        const isbnText = getCurrentISBN();

        bookInfoElement.innerHTML = `<p>${bookTitle} by ${authorName}</p>`;
        bookInfoElement.innerHTML += `<p class="isbn-info">ISBN: ${isbnText}</p>`;
    }

    function readBook() {
        
        const pdfUrl = '{% static "mech.pdf" %}';
        
        loadPDF(pdfUrl);
    }

    function copyISBN() {
        const isbnText = getCurrentISBN();

        // Copy ISBN to clipboard
        navigator.clipboard.writeText(isbnText).then(function () {
            alert('ISBN copied to clipboard: ' + isbnText);
        });
    }

    function getCurrentISBN() {
        // Retrieve and return the ISBN from the clicked book card
        const activeBook = document.querySelector('.recent-book.active');
        const isbnElement = activeBook.querySelector('.isbn');
        return isbnElement.textContent.trim();
    }

    function closePopover() {
        const pdfViewer = document.getElementById('pdf-viewer');
        pdfViewer.style.display = 'none';
    }

    document.addEventListener('DOMContentLoaded', function () {
        // Example: Load PDF when a book is clicked
        const bookCards = document.querySelectorAll('.book-card');
        bookCards.forEach(function (bookCard) {
            bookCard.addEventListener('click', function () {
                
                // Remove active class from all books
                bookCards.forEach(function (book) {
                    book.classList.remove('active');
                });

                // Add active class to the clicked book
                bookCard.classList.add('active');

                // Load PDF for the clicked book
                readBook();
            });
        });
    });

</script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>


{% endblock content %}